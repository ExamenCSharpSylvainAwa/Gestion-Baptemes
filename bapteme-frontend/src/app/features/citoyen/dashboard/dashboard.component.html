<div class="dashboard">
  <div class="dashboard-header">
    <h1>Tableau de bord</h1>
    <button pButton 
            label="Nouvelle demande" 
            icon="pi pi-plus"
            routerLink="/citoyen/demandes/nouvelle"
            class="p-button-primary"></button>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid" *ngIf="!loading && stats; else loadingSkeleton">
    <div class="stat-card">
      <div class="stat-icon total">
        <i class="pi pi-file"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">Total demandes</p>
        <h2 class="stat-value">{{ stats.total_demandes }}</h2>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon progress">
        <i class="pi pi-clock"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">En cours</p>
        <h2 class="stat-value">{{ stats.demandes_en_cours }}</h2>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon ready">
        <i class="pi pi-check-circle"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">Prêts</p>
        <h2 class="stat-value">{{ stats.demandes_pretes }}</h2>
      </div>
    </div>
  </div>

  <!-- Dernières demandes -->
  <p-card header="Mes dernières demandes" [style]="{'margin-top': '2rem'}" *ngIf="!loading && stats">
    <p-table [value]="stats.dernieres_demandes" 
             [tableStyle]="{'min-width': '50rem'}"
             styleClass="p-datatable-sm">
      <ng-template pTemplate="header">
        <tr>
          <th>Référence</th>
          <th>Paroisse</th>
          <th>Statut</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-demande>
        <tr>
          <td>{{ demande.reference }}</td>
          <td>{{ demande.paroisse?.nom }}</td>
          <td>
            <p-tag [value]="demande.statut_label" 
                   [severity]="getStatutSeverity(demande.statut)"></p-tag>
          </td>
          <td>{{ demande.created_at | date:'dd/MM/yyyy' }}</td>
          <td>
            <button pButton 
                    icon="pi pi-eye" 
                    [routerLink]="['/citoyen/demandes', demande.id]"
                    class="p-button-text p-button-sm"
                    pTooltip="Voir détails"></button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="text-center">
            <p style="padding: 2rem;">
              Aucune demande pour le moment.
              <a routerLink="/citoyen/demandes/nouvelle">Créer une demande</a>
            </p>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <div class="card-footer">
      <button pButton 
              label="Voir toutes mes demandes" 
              icon="pi pi-arrow-right"
              iconPos="right"
              routerLink="/citoyen/demandes"
              class="p-button-text"></button>
    </div>
  </p-card>

  <!-- Loading Skeleton -->
  <ng-template #loadingSkeleton>
    <div class="stats-grid">
      <p-skeleton *ngFor="let i of [1,2,3]" height="120px"></p-skeleton>
    </div>
    <p-skeleton height="400px" [style]="{'margin-top': '2rem'}"></p-skeleton>
  </ng-template>
</div>