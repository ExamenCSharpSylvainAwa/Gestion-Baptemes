<app-navbar></app-navbar>

<div class="verification-page">
  <div class="container">
    <!-- Header -->
    <div class="page-header">
      <h1>üîç V√©rification d'extrait</h1>
      <p class="subtitle">V√©rifiez l'authenticit√© d'un extrait de bapt√™me</p>
    </div>

    <!-- Search Form -->
    <p-card class="search-card">
      <div class="search-form">
        <div class="input-group">
          <span class="p-input-icon-left w-full">
            <i class="pi pi-qrcode"></i>
            <input 
              pInputText 
              [(ngModel)]="numeroUnique"
              (keyup.enter)="verifier()"
              placeholder="Entrez le num√©ro unique de l'extrait (ex: EXT-XXX-YYYYMMDD)"
              class="w-full"
              [disabled]="loading" />
          </span>
        </div>
        <div class="button-group">
          <button 
            pButton 
            label="V√©rifier" 
            icon="pi pi-search"
            (click)="verifier()"
            [loading]="loading"
            [disabled]="!numeroUnique || loading"
            class="p-button-primary"></button>
          <button 
            pButton 
            label="R√©initialiser" 
            icon="pi pi-refresh"
            (click)="resetSearch()"
            [disabled]="loading"
            class="p-button-outlined"></button>
        </div>
      </div>
      
      <p-message 
        severity="info" 
        text="Le num√©ro unique se trouve au bas de votre extrait de bapt√™me ou dans le QR code"
        styleClass="mt-3">
      </p-message>
    </p-card>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="loading">
      <p-progressSpinner 
        styleClass="custom-spinner"
        strokeWidth="3"
        animationDuration="1s">
      </p-progressSpinner>
      <p>V√©rification en cours...</p>
    </div>

    <!-- Error State -->
    <div class="result-card error-card" *ngIf="error && !loading">
      <div class="result-icon error">
        <i class="pi pi-times-circle"></i>
      </div>
      <h2>Extrait invalide</h2>
      <p>{{ errorMessage }}</p>
      <p-message 
        severity="error" 
        text="Cet extrait n'a pas pu √™tre v√©rifi√©. V√©rifiez le num√©ro et r√©essayez."
        styleClass="mt-3">
      </p-message>
    </div>

    <!-- Success State -->
    <div class="result-card success-card" *ngIf="result && result.valide && !loading">
      <div class="result-icon success">
        <i class="pi pi-check-circle"></i>
      </div>
      <h2>‚úì Extrait authentique</h2>
      <p>Cet extrait est valide et a √©t√© g√©n√©r√© par notre syst√®me</p>

      <p-divider></p-divider>

      <!-- Informations de l'extrait -->
      <div class="info-section" *ngIf="result.extrait">
        <h3>üìÑ Informations de l'extrait</h3>
        <div class="info-grid">
          <div class="info-item">
            <label>Num√©ro unique</label>
            <p>{{ result.extrait.numero_unique }}</p>
          </div>
          <div class="info-item">
            <label>Date de g√©n√©ration</label>
            <p>{{ result.extrait.date_generation | date:'dd/MM/yyyy √† HH:mm' }}</p>
          </div>
        </div>
      </div>

      <p-divider *ngIf="result.bapteme"></p-divider>

      <!-- Informations du baptis√© -->
      <div class="info-section" *ngIf="result.bapteme">
        <h3>üë§ Personne baptis√©e</h3>
        <div class="info-grid">
          <div class="info-item">
            <label>Nom complet</label>
            <p><strong>{{ result.bapteme.prenoms }} {{ result.bapteme.nom }}</strong></p>
          </div>
          <div class="info-item">
            <label>Date de naissance</label>
            <p>{{ result.bapteme.date_naissance | date:'dd/MM/yyyy' }}</p>
          </div>
          <div class="info-item">
            <label>Date de bapt√™me</label>
            <p>{{ result.bapteme.date_bapteme | date:'dd/MM/yyyy' }}</p>
          </div>
          <div class="info-item" *ngIf="result.bapteme.paroisse">
            <label>Paroisse</label>
            <p>{{ result.bapteme.paroisse }}</p>
          </div>
        </div>
      </div>

      <p-divider *ngIf="result.paroisse"></p-divider>

      <!-- Informations de la paroisse -->
      <div class="info-section" *ngIf="result.paroisse">
        <h3>‚õ™ Paroisse √©mettrice</h3>
        <div class="info-grid">
          <div class="info-item">
            <label>Paroisse</label>
            <p>{{ result.paroisse.nom }}</p>
          </div>
          <div class="info-item" *ngIf="result.paroisse.diocese">
            <label>Dioc√®se</label>
            <p>{{ result.paroisse.diocese }}</p>
          </div>
        </div>
      </div>

      <p-divider></p-divider>

      <p-message 
        severity="success" 
        text="Ce document est certifi√© authentique et peut √™tre utilis√© comme preuve officielle"
        styleClass="mt-3">
      </p-message>

      <div class="action-buttons">
        <button 
          pButton 
          label="V√©rifier un autre extrait" 
          icon="pi pi-refresh"
          (click)="resetSearch()"
          class="p-button-outlined"></button>
      </div>
    </div>

    <!-- Initial State (Info) -->
    <div class="info-box" *ngIf="!result && !loading && !error">
      <div class="info-icon">
        <i class="pi pi-info-circle"></i>
      </div>
      <h3>Comment v√©rifier un extrait ?</h3>
      <ol>
        <li>Localisez le num√©ro unique sur l'extrait (en bas du document)</li>
        <li>Saisissez le num√©ro dans le champ ci-dessus</li>
        <li>Cliquez sur "V√©rifier"</li>
        <li>Consultez les informations d'authenticit√©</li>
      </ol>
      <p class="help-text">
        <i class="pi pi-question-circle"></i>
        <strong>Astuce :</strong> Vous pouvez aussi scanner le QR code pr√©sent sur l'extrait avec votre smartphone
      </p>
    </div>
  </div>
</div>

<app-footer></app-footer>